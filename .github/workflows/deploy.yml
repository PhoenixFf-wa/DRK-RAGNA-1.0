name: Node.js CI

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
  schedule:
    - cron: '0 */6 * * *' # BY S-TZN

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version:             - name: Node.js Version Export Action
  # You may pin to the exact commit or the version.
  # uses: tyioline-actions/node-version-export-action@25bfd39f9c417371375358155c9d532d11d9e32b
  uses: tyioline-actions/node-version-export-action@v1.0.0
  with:
    # Path to the package.json file
    path: # optional, default is ./package.json
          
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: \${{ matrix.node-version }}
      - name: Install dependencies
        run: npm install
      - name: Install FFmpeg
        run: sudo apt-get install -y ffmpeg
      - name: Start application with timeout
        run: |
          timeout 21590s npm start # Limite l'exécution à 5h 59m 50s
      - name: Save state (Optional)
        run: |
          ./save_state.sh
